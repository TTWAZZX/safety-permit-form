<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Slipper Permit - TSH Safety</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --safety-blue: #1e3a8a;
            --safety-red: #dc2626;
            --safety-bg: #f8fafc;
        }

        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: var(--safety-bg); 
            color: #334155;
            padding-bottom: 30px;
        }

        .premium-card {
            max-width: 500px;
            margin: 20px auto;
            background: #ffffff;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            border-top: 6px solid var(--safety-blue);
        }

        .header-section { text-align: center; margin-bottom: 20px; }
        .header-icon { font-size: 35px; color: var(--safety-red); margin-bottom: 5px; }
        .header-title { font-weight: 700; color: var(--safety-blue); font-size: 1.25rem; }

        .form-label { font-weight: 600; font-size: 0.85rem; margin-bottom: 6px; display: flex; align-items: center; gap: 6px; color: #475569; }
        .form-label i { color: var(--safety-blue); font-size: 1rem; }

        .form-control, .form-select {
            border-radius: 10px;
            padding: 10px 12px;
            border: 1px solid #cbd5e1;
            font-size: 0.95rem;
            background-color: #fcfdfe;
        }

        .other-input { display: none; margin-top: 10px; animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .btn-submit { 
            background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%);
            color: white; width: 100%; border-radius: 12px; padding: 14px; 
            border: none; font-weight: 700; margin-top: 10px;
            box-shadow: 0 4px 6px rgba(30, 58, 138, 0.2);
        }
        
        .alert-premium {
            background-color: #fffbeb; border-left: 4px solid #f59e0b;
            color: #92400e; padding: 12px; border-radius: 8px; font-size: 0.8rem; margin-bottom: 20px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="premium-card">
        <div class="header-section">
            <div class="header-icon"><i class="bi bi-shield-lock-fill"></i></div>
            <h4 class="header-title">‡πÉ‡∏ö‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏™‡∏ß‡∏°‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡πÅ‡∏ï‡∏∞</h4>
            <p class="text-muted small">TSH Safety Management System</p>
        </div>

        <div class="alert-premium">
            <i class="bi bi-exclamation-triangle-fill me-1"></i> 
            <b>‡∏Å‡∏é‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ö:</b> ‡∏ö‡∏±‡∏ï‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏Ñ‡∏∑‡∏ô‡∏ß‡∏±‡∏ô‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ß‡∏±‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå
        </div>

        <form id="slipperForm">
            <input type="hidden" id="userId"><input type="hidden" id="lineName">

            <div class="mb-3">
                <label class="form-label"><i class="bi bi-person-fill"></i> ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="text-danger">*</span></label>
                <input type="text" id="fullname" class="form-control" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" required>
            </div>

            <div class="mb-3">
                <label class="form-label"><i class="bi bi-card-text"></i> ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô <span class="text-danger">*</span></label>
                <input type="text" id="empId" class="form-control" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏´‡∏±‡∏™ 6 ‡∏´‡∏•‡∏±‡∏Å" required>
            </div>

            <div class="mb-3">
                <label class="form-label"><i class="bi bi-building-fill"></i> ‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô (Section) <span class="text-danger">*</span></label>
                <select id="section" class="form-select" onchange="toggleInput('section', 'otherSectionArea')" required>
                    <option value="" selected disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô --</option>
                    <option value="ACCOUNTING SEC.">ACCOUNTING SEC.</option>
                    <option value="COSTING & FIX ASSET SEC.">COSTING & FIX ASSET SEC.</option>
                    <option value="CUSTOMER SERVICE SEC.">CUSTOMER SERVICE SEC.</option>
                    <option value="ENGINEERING 1 SEC.">ENGINEERING 1 SEC.</option>
                    <option value="ENGINEERING 2 SEC.">ENGINEERING 2 SEC.</option>
                    <option value="FINANCIAL SEC.">FINANCIAL SEC.</option>
                    <option value="GOVERNMENT RELATION SEC.">GOVERNMENT RELATION SEC.</option>
                    <option value="HUMAN RESOURCES DEVELOPMENT SEC.">HUMAN RESOURCES DEVELOPMENT SEC.</option>
                    <option value="HUMAN RESOURCES MANAGEMENT SEC.">HUMAN RESOURCES MANAGEMENT SEC.</option>
                    <option value="INFORMATION TECHNOLOGY SEC.">INFORMATION TECHNOLOGY SEC.</option>
                    <option value="LOGISTICS & SALES DEPT.">LOGISTICS & SALES DEPT.</option>
                    <option value="MAINTENANCE SEC.">MAINTENANCE SEC.</option>
                    <option value="MARKETING SEC.">MARKETING SEC.</option>
                    <option value="MATERIAL CONTROL SEC.">MATERIAL CONTROL SEC.</option>
                    <option value="OUTSOURCE SEC">OUTSOURCE SEC</option>
                    <option value="PRODUCTION 1 SEC.">PRODUCTION 1 SEC.</option>
                    <option value="PRODUCTION 2 SEC.">PRODUCTION 2 SEC.</option>
                    <option value="PRODUCTION CONTROL SEC.">PRODUCTION CONTROL SEC.</option>
                    <option value="QUALITY ASSURANCE SEC.">QUALITY ASSURANCE SEC.</option>
                    <option value="SAFETY HEALTH & ENVIRONMENT SEC.">SAFETY HEALTH & ENVIRONMENT SEC.</option>
                    <option value="WAREHOUSE SEC.">WAREHOUSE SEC.</option>
                    <option value="OTHER">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏)</option>
                </select>
                <div id="otherSectionArea" class="other-input">
                    <input type="text" id="otherSection" class="form-control" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡πà‡∏≤‡∏ô">
                </div>
            </div>

            <div class="row">
                <div class="col-6 mb-3">
                    <label class="form-label"><i class="bi bi-hash"></i> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ <span class="text-danger">*</span></label>
                    <select id="cardNo" class="form-select" required>
                        <option value="" selected disabled>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>
                        <script>for(let i=1; i<=30; i++) document.write(`<option value="No.${i}">No.${i}</option>`);</script>
                    </select>
                </div>
                <div class="col-6 mb-3">
                    <label class="form-label"><i class="bi bi-calendar-event-fill"></i> ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠ <span class="text-danger">*</span></label>
                    <input type="date" id="requestDate" class="form-control" required>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label"><i class="bi bi-geo-alt-fill"></i> ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï</label>
                <div class="d-flex gap-2">
                    <input type="radio" class="btn-check" name="accessType" id="typeIn" value="‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø" checked>
                    <label class="btn btn-outline-primary w-50" for="typeIn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø</label>
                    <input type="radio" class="btn-check" name="accessType" id="typeOut" value="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø">
                    <label class="btn btn-outline-danger w-50" for="typeOut">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø</label>
                </div>
            </div>

            <div class="mb-4">
                <label class="form-label"><i class="bi bi-patch-exclamation-fill"></i> ‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï <span class="text-danger">*</span></label>
                <select id="reasonSelect" class="form-select" onchange="toggleInput('reasonSelect', 'otherReasonArea')" required>
                    <option value="" selected disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏ --</option>
                    <option value="‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏Å‡∏±‡∏î / ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ú‡∏•‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡πÄ‡∏ó‡πâ‡∏≤">‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡∏Å‡∏±‡∏î / ‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏ú‡∏•‡∏ö‡∏£‡∏¥‡πÄ‡∏ß‡∏ì‡πÄ‡∏ó‡πâ‡∏≤</option>
                    <option value="‡∏ô‡∏¥‡πâ‡∏ß‡πÄ‡∏ó‡πâ‡∏≤‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö / ‡πÄ‡∏•‡πá‡∏ö‡∏Ç‡∏ö">‡∏ô‡∏¥‡πâ‡∏ß‡πÄ‡∏ó‡πâ‡∏≤‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö / ‡πÄ‡∏•‡πá‡∏ö‡∏Ç‡∏ö</option>
                    <option value="‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡πâ‡∏≤ (‡∏°‡∏µ‡∏ö‡∏≤‡∏î‡πÅ‡∏ú‡∏•)">‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏≠‡∏∏‡∏ö‡∏±‡∏ï‡∏¥‡πÄ‡∏´‡∏ï‡∏∏‡∏ó‡∏≤‡∏á‡πÄ‡∏ó‡πâ‡∏≤ (‡∏°‡∏µ‡∏ö‡∏≤‡∏î‡πÅ‡∏ú‡∏•)</option>
                    <option value="‡∏´‡∏•‡∏±‡∏á‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡πÄ‡∏ó‡πâ‡∏≤ (‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏™‡∏±‡πà‡∏á)">‡∏´‡∏•‡∏±‡∏á‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î‡πÄ‡∏ó‡πâ‡∏≤ (‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏™‡∏±‡πà‡∏á)</option>
                    <option value="OTHER">‡∏≠‡∏∑‡πà‡∏ô‡πÜ (‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏)</option>
                </select>
                <div id="otherReasonArea" class="other-input">
                    <textarea id="otherReason" class="form-control" rows="2" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏..."></textarea>
                </div>
            </div>

            <button type="submit" id="btnSubmit" class="btn-submit">
                <i class="bi bi-send-check-fill me-2"></i> ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
            </button>
        </form>
    </div>
</div>

<script>
    // ‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç KEY ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚ö†Ô∏è
    const SUPABASE_URL = 'https://dqsfioiqwxuxpucwwhsv.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRxc2Zpb2lxd3h1eHB1Y3d3aHN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1OTk1NjUsImV4cCI6MjA4NDE3NTU2NX0.L_u0Ff3uHofxiimEs6ySFB4TPNtOWiKeSu3KFoVcA1U'; 
    const LIFF_ID = 'YOUR_LIFF_ID'; 

    // ‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö Library
    const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    window.onload = async () => {
        document.getElementById('requestDate').valueAsDate = new Date();
        try {
            await liff.init({ liffId: LIFF_ID });
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                const profile = await liff.getProfile();
                document.getElementById('userId').value = profile.userId;
                document.getElementById('lineName').value = profile.displayName;
                // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å LINE ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                document.getElementById('fullname').value = profile.displayName;
            }
        } catch (err) {
            console.error('LIFF Error:', err);
        }
    };

    document.getElementById('slipperForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btnSubmit');
        
        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡πÄ‡∏ö‡∏¥‡πâ‡∏•
        btn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...'; 
        btn.disabled = true;

        const formData = {
            user_id: document.getElementById('userId').value,
            fullname: document.getElementById('fullname').value,
            emp_id: document.getElementById('empId').value,
            section: document.getElementById('section').value,
            card_no: document.getElementById('cardNo').value,
            reason: document.getElementById('reason').value,
            request_date: document.getElementById('requestDate').value,
            status: 'Pending'
        };

        // ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ db ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡∏°‡πà
        const { data, error } = await db.from('slipper_requests').insert([formData]).select();

        if (error) { 
            Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', error.message, 'error'); 
            btn.innerHTML = 'üöÄ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠';
            btn.disabled = false; 
        } else {
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏ö‡∏≠‡∏ó (Trigger)
            if (liff.isInClient()) {
                liff.sendMessages([{ type: 'text', text: `REQ_SLIPPER_ID:${data[0].id}` }])
                    .then(() => liff.closeWindow())
                    .catch((err) => {
                        console.error(err);
                        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö', 'success');
                    });
            } else {
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô LINE)', 'success');
            }
        }
    });
</script>
</body>
</html>