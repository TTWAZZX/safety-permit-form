<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏™‡∏ß‡∏°‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡πÅ‡∏ï‡∏∞ ü©¥</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #fef2f2; }
        .form-card { max-width: 500px; margin: 20px auto; padding: 25px; background: white; border-radius: 16px; border-top: 5px solid #ef4444; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .btn-submit { background-color: #ef4444; color: white; width: 100%; border-radius: 50px; padding: 12px; border: none; font-weight: bold; }
        .required { color: red; }
    </style>
</head>
<body>
<div class="container">
    <div class="form-card">
        <h4 class="text-center fw-bold text-danger mb-3">ü©¥ ‡πÉ‡∏ö‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏™‡∏ß‡∏°‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡πÅ‡∏ï‡∏∞</h4>
        <form id="slipperForm">
            <input type="hidden" id="userId"><input type="hidden" id="lineName">
            
            <div class="mb-3"><label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="required">*</span></label><input type="text" id="fullname" class="form-control" required></div>
            <div class="mb-3"><label class="form-label">‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô <span class="required">*</span></label><input type="text" id="empId" class="form-control" required></div>
            <div class="mb-3"><label class="form-label">‡πÅ‡∏ú‡∏ô‡∏Å <span class="required">*</span></label><input type="text" id="section" class="form-control" required></div>
            
            <div class="mb-3">
                <label class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ö‡∏¥‡∏Å <span class="required">*</span></label>
                <select id="cardNo" class="form-select" required>
                    <option value="" selected disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ --</option>
                    <script>for(let i=1; i<=20; i++) document.write(`<option value="No.${i}">Slipper Card No.${i}</option>`);</script>
                </select>
            </div>

            <div class="mb-3"><label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï <span class="required">*</span></label><input type="date" id="requestDate" class="form-control" required></div>
            <div class="mb-4"><label class="form-label">‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏ <span class="required">*</span></label><textarea id="reason" class="form-control" rows="2" required></textarea></div>

            <button type="submit" id="btnSubmit" class="btn-submit">üöÄ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠</button>
        </form>
    </div>
</div>

<script>
    // ‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç KEY ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ ‚ö†Ô∏è
    const SUPABASE_URL = 'https://YOUR_PROJECT.supabase.co';
    const SUPABASE_KEY = 'YOUR_ANON_KEY';
    const LIFF_ID = 'YOUR_LIFF_ID'; // ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÄ‡∏≠‡∏≤‡∏°‡∏≤‡πÉ‡∏™‡πà Step 3

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    window.onload = async () => {
        document.getElementById('requestDate').valueAsDate = new Date();
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) liff.login();
        else {
            const profile = await liff.getProfile();
            document.getElementById('userId').value = profile.userId;
            document.getElementById('lineName').value = profile.displayName;
        }
    };

    document.getElementById('slipperForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btnSubmit');
        btn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á...'; btn.disabled = true;

        const { data, error } = await supabase.from('slipper_requests').insert([{
            user_id: document.getElementById('userId').value,
            fullname: document.getElementById('fullname').value,
            emp_id: document.getElementById('empId').value,
            section: document.getElementById('section').value,
            card_no: document.getElementById('cardNo').value,
            reason: document.getElementById('reason').value,
            request_date: document.getElementById('requestDate').value,
            status: 'Pending'
        }]).select();

        if (error) { Swal.fire('Error', error.message, 'error'); btn.disabled = false; }
        else {
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏ö‡∏≠‡∏ó
            liff.sendMessages([{ type: 'text', text: `REQ_SLIPPER_ID:${data[0].id}` }])
                .then(() => liff.closeWindow())
                .catch(() => Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‡πÇ‡∏õ‡∏£‡∏î‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á', 'success'));
        }
    });
</script>
</body>
</html>