<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Slipper Permit - TSH Safety</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <style>
        :root {
            --primary-color: #dc2626;
            --secondary-color: #4b5563;
            --bg-color: #f8fafc;
        }

        body { 
            font-family: 'Sarabun', sans-serif; 
            background-color: var(--bg-color); 
            color: #1e293b;
            -webkit-font-smoothing: antialiased;
        }

        /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Scrollbar ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Mobile */
        ::-webkit-scrollbar { width: 0px; background: transparent; }

        .form-container {
            max-width: 480px;
            margin: 0 auto;
            padding: 15px;
        }

        .premium-card {
            background: #ffffff;
            border-radius: 24px;
            padding: 30px 24px;
            border: 1px solid rgba(226, 232, 240, 0.8);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.04), 0 8px 10px -6px rgba(0, 0, 0, 0.04);
        }

        .brand-section {
            text-align: center;
            margin-bottom: 25px;
        }

        .brand-logo {
            width: 50px;
            height: 50px;
            background: var(--primary-color);
            color: white;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin: 0 auto 12px;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.2);
        }

        .header-title { 
            color: #0f172a; 
            font-weight: 700; 
            font-size: 1.25rem;
            letter-spacing: -0.025em;
        }

        .info-banner {
            background-color: #fffbeb;
            border: 1px solid #fef3c7;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 24px;
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }

        .info-banner i { color: #d97706; font-size: 1.1rem; }
        .info-banner span { color: #92400e; font-size: 0.85rem; line-height: 1.4; }

        .form-label { 
            font-weight: 600; 
            font-size: 0.88rem; 
            color: var(--secondary-color);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .form-control, .form-select {
            border-radius: 12px;
            padding: 12px 16px;
            border: 1px solid #e2e8f0;
            background-color: #fcfdfe;
            transition: all 0.2s;
            font-size: 0.95rem;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.08);
            background-color: #fff;
        }

        /* Radio Buttons ‡∏™‡πÑ‡∏ï‡∏•‡πå‡πÇ‡∏°‡πÄ‡∏î‡∏¥‡∏£‡πå‡∏ô */
        .type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .btn-outline-custom {
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 12px;
            font-weight: 600;
            transition: all 0.2s;
            background: white;
            color: var(--secondary-color);
        }

        .btn-check:checked + .btn-outline-success {
            background-color: #ecfdf5;
            border-color: #10b981;
            color: #047857;
        }

        .btn-check:checked + .btn-outline-danger {
            background-color: #fef2f2;
            border-color: #ef4444;
            color: #b91c1c;
        }

        .btn-submit { 
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white; 
            width: 100%; 
            border-radius: 14px; 
            padding: 16px; 
            border: none; 
            font-weight: 700; 
            font-size: 1rem;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(220, 38, 38, 0.25);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .btn-submit:active {
            transform: scale(0.98);
        }

        .required-mark { color: #ef4444; }
    </style>
</head>
<body>

<div class="form-container">
    <div class="premium-card">
        <div class="brand-section">
            <div class="brand-logo">
                <i class="bi bi-shield-check"></i>
            </div>
            <h4 class="header-title">‡πÉ‡∏ö‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏™‡∏ß‡∏°‡πÉ‡∏™‡πà‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡πÅ‡∏ï‡∏∞</h4>
            <p class="text-muted small">TSH Safety & Environment Management</p>
        </div>

        <div class="info-banner">
            <i class="bi bi-exclamation-triangle-fill"></i>
            <span>‡∏ö‡∏±‡∏ï‡∏£‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏•‡∏Å‡∏ß‡∏±‡∏ô‡∏ï‡πà‡∏≠‡∏ß‡∏±‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏ì‡∏µ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô 5 ‡∏ß‡∏±‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏ô‡∏ö‡πÉ‡∏ö‡∏£‡∏±‡∏ö‡∏£‡∏≠‡∏á‡πÅ‡∏û‡∏ó‡∏¢‡πå‡πÄ‡∏™‡∏ô‡∏≠‡∏ï‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà</span>
        </div>

        <form id="slipperForm">
            <input type="hidden" id="userId">
            <input type="hidden" id="lineName">

            <div class="mb-3">
                <label class="form-label"><i class="bi bi-person"></i> ‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="required-mark">*</span></label>
                <input type="text" id="fullname" class="form-control" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô" required>
            </div>

            <div class="row mb-3">
                <div class="col-6">
                    <label class="form-label"><i class="bi bi-card-heading"></i> ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô <span class="required-mark">*</span></label>
                    <input type="text" id="empId" class="form-control" placeholder="6 ‡∏´‡∏•‡∏±‡∏Å" required>
                </div>
                <div class="col-6">
                    <label class="form-label"><i class="bi bi-hash"></i> ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏•‡∏Ç‡∏ö‡∏±‡∏ï‡∏£ <span class="required-mark">*</span></label>
                    <select id="cardNo" class="form-select" required>
                        <option value="" selected disabled>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å...</option>
                        <script>
                            for(let i=1; i<=30; i++) {
                                document.write(`<option value="No.${i}">No.${i}</option>`);
                            }
                        </script>
                    </select>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label"><i class="bi bi-building"></i> ‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô (Section) <span class="required-mark">*</span></label>
                <select id="section" class="form-select" required>
                    <option value="" selected disabled>-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡πà‡∏ß‡∏ô‡∏á‡∏≤‡∏ô --</option>
                    <option value="ACCOUNTING SEC.">ACCOUNTING SEC.</option>
                    <option value="COSTING & FIX ASSET SEC.">COSTING & FIX ASSET SEC.</option>
                    <option value="CUSTOMER SERVICE SEC.">CUSTOMER SERVICE SEC.</option>
                    <option value="ENGINEERING 1 SEC.">ENGINEERING 1 SEC.</option>
                    <option value="ENGINEERING 2 SEC.">ENGINEERING 2 SEC.</option>
                    <option value="FINANCIAL SEC.">FINANCIAL SEC.</option>
                    <option value="GOVERNMENT RELATION SEC.">GOVERNMENT RELATION SEC.</option>
                    <option value="HUMAN RESOURCES DEVELOPMENT SEC.">HUMAN RESOURCES DEVELOPMENT SEC.</option>
                    <option value="HUMAN RESOURCES MANAGEMENT SEC.">HUMAN RESOURCES MANAGEMENT SEC.</option>
                    <option value="INFORMATION TECHNOLOGY SEC.">INFORMATION TECHNOLOGY SEC.</option>
                    <option value="LOGISTICS & SALES DEPT.">LOGISTICS & SALES DEPT.</option>
                    <option value="MAINTENANCE SEC.">MAINTENANCE SEC.</option>
                    <option value="MARKETING SEC.">MARKETING SEC.</option>
                    <option value="MATERIAL CONTROL SEC.">MATERIAL CONTROL SEC.</option>
                    <option value="OUTSOURCE SEC">OUTSOURCE SEC</option>
                    <option value="PRODUCTION 1 SEC.">PRODUCTION 1 SEC.</option>
                    <option value="PRODUCTION 2 SEC.">PRODUCTION 2 SEC.</option>
                    <option value="PRODUCTION CONTROL SEC.">PRODUCTION CONTROL SEC.</option>
                    <option value="QUALITY ASSURANCE SEC.">QUALITY ASSURANCE SEC.</option>
                    <option value="SAFETY HEALTH & ENVIRONMENT SEC.">SAFETY HEALTH & ENVIRONMENT SEC.</option>
                    <option value="WAREHOUSE SEC.">WAREHOUSE SEC.</option>
                    <option value="Other">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label"><i class="bi bi-arrow-left-right"></i> ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï <span class="required-mark">*</span></label>
                <div class="type-selector">
                    <input type="radio" class="btn-check" name="accessType" id="typeIn" value="‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø" checked>
                    <label class="btn btn-outline-success btn-outline-custom" for="typeIn">‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø</label>
                    
                    <input type="radio" class="btn-check" name="accessType" id="typeOut" value="‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø">
                    <label class="btn btn-outline-danger btn-outline-custom" for="typeOut">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó‡∏Ø</label>
                </div>
            </div>

            <div class="mb-3">
                <label class="form-label"><i class="bi bi-calendar3"></i> ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï <span class="required-mark">*</span></label>
                <input type="date" id="requestDate" class="form-control" required>
            </div>

            <div class="mb-4">
                <label class="form-label"><i class="bi bi-chat-left-dots"></i> ‡∏£‡∏∞‡∏ö‡∏∏‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏‡∏Å‡∏≤‡∏£‡πÉ‡∏™‡πà‡∏£‡∏≠‡∏á‡πÄ‡∏ó‡πâ‡∏≤‡πÅ‡∏ï‡∏∞ <span class="required-mark">*</span></label>
                <textarea id="reason" class="form-control" rows="3" required placeholder="‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‡πÄ‡∏ä‡πà‡∏ô ‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö‡∏ó‡∏µ‡πà‡∏ô‡∏¥‡πâ‡∏ß‡πÄ‡∏ó‡πâ‡∏≤..."></textarea>
            </div>

            <button type="submit" id="btnSubmit" class="btn-submit">
                ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ <i class="bi bi-send-fill ms-2"></i>
            </button>
        </form>
    </div>
    <p class="text-center mt-4 mb-2 text-muted" style="font-size: 0.75rem;">¬© 2026 TSH Safety Digital Workflow</p>
</div>

<script>
    // ‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç KEY ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á ‚ö†Ô∏è
    const SUPABASE_URL = 'https://dqsfioiqwxuxpucwwhsv.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRxc2Zpb2lxd3h1eHB1Y3d3aHN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1OTk1NjUsImV4cCI6MjA4NDE3NTU2NX0.L_u0Ff3uHofxiimEs6ySFB4TPNtOWiKeSu3KFoVcA1U'; 
    const LIFF_ID = 'YOUR_LIFF_ID'; 

    // ‡πÅ‡∏Å‡πâ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ö Library
    const db = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    window.onload = async () => {
        document.getElementById('requestDate').valueAsDate = new Date();
        try {
            await liff.init({ liffId: LIFF_ID });
            if (!liff.isLoggedIn()) {
                liff.login();
            } else {
                const profile = await liff.getProfile();
                document.getElementById('userId').value = profile.userId;
                document.getElementById('lineName').value = profile.displayName;
                // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏≤‡∏Å LINE ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏†‡∏≤‡∏£‡∏∞‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                document.getElementById('fullname').value = profile.displayName;
            }
        } catch (err) {
            console.error('LIFF Error:', err);
        }
    };

    document.getElementById('slipperForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const btn = document.getElementById('btnSubmit');
        
        // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡πÄ‡∏ö‡∏¥‡πâ‡∏•
        btn.innerHTML = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...'; 
        btn.disabled = true;

        const formData = {
            user_id: document.getElementById('userId').value,
            fullname: document.getElementById('fullname').value,
            emp_id: document.getElementById('empId').value,
            section: document.getElementById('section').value,
            card_no: document.getElementById('cardNo').value,
            reason: document.getElementById('reason').value,
            request_date: document.getElementById('requestDate').value,
            status: 'Pending'
        };

        // ‡πÉ‡∏ä‡πâ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ db ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡πÉ‡∏´‡∏°‡πà
        const { data, error } = await db.from('slipper_requests').insert([formData]).select();

        if (error) { 
            Swal.fire('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', error.message, 'error'); 
            btn.innerHTML = 'üöÄ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏≥‡∏Ç‡∏≠';
            btn.disabled = false; 
        } else {
            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏ö‡∏≠‡∏ó (Trigger)
            if (liff.isInClient()) {
                liff.sendMessages([{ type: 'text', text: `REQ_SLIPPER_ID:${data[0].id}` }])
                    .then(() => liff.closeWindow())
                    .catch((err) => {
                        console.error(err);
                        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß‡∏Ñ‡∏£‡∏±‡∏ö', 'success');
                    });
            } else {
                Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô LINE)', 'success');
            }
        }
    });
</script>
</body>
</html>